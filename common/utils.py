from django.apps import apps


def is_instance_used(instance, exclude=None):
    if exclude is None:
        exclude = []

    related_classes = set()

    for model in apps.get_models():
        for field in model._meta.get_fields():
            if field.is_relation and field.related_model == instance.__class__ and not field.many_to_many:
                if model.objects.filter(**{field.name: instance}).exists():
                    related_classes.add(model)

    related_classes.difference_update(exclude)
    print("is_instance_used() related_classes: ", related_classes)

    return len(related_classes) > 0

["id","id_apeam","nombre","kgs","activo"],

cajas = [
["1","1","CARTON DE 11.3","11.3","0"],
["2","3","CARTON DE 13","13","1"],
["3","4","CARTON DE 10","10","1"],
["4","5","CARTON DE 10.7","10.7","1"],
["5","6","CARTON DE 16.9","16.9","1"],
["6","7","CARTON DE 14.4","14.4","1"],
["7","8","PLASTICO DE 16.9","16.9","1"],
["8","9","CARTON DE 11.25","11.25","1"],
["9","10","CARTON DE 17","17","1"],
["10","11","PLASTICO DE 17","17","1"],
["11","12","CARTON DE 14","14","1"],
["12","13","CARTON DE 5.625","5.625","1"],
["13","14","CARTON DE 20","20","1"],
["14","15","CARTON DE 17.20","17.2","1"],
["15","16","CARTON DE 18","18","1"],
["16","17","CARTON DE 19","19","1"],
["17","18","CARTON DE 5.6","5.6","1"],
["18","19","PLASTICO DE 17.2","17.2","1"],
["19","20","CARTON DE 16.5","16.5","1"],
["20","23","CARTON DE 11","11","1"],
["21","25","CARTON DE 5.5","5.5","1"],
["22","26","CARTON DE 12","12","1"],
["23","27","CARTON DE 14.2","14.2","1"],
["24","28","CARTON DE 10.8","10.8","1"],
["25","29","CARTON DE 15.2","15.2","1"],
["26","30","CARTON DE 17.5","17.5","1"],
["27","31","CARTON DE 11.20","11.2","1"],
["28","32","CARTON DE 19.1","19.1","1"],
["29","33","CARTON DE 18.5","18.5","1"],
["30","34","CARTON DE 6","6","0"],
["31","35","CARTON DE 15","15","1"],
["32","36","CARTON DE 16.0","16","1"],
["33","37","CARTON DE 15.4","15.4","1"],
["34","38","PLASTICO DE 16","16","1"],
["35","39","CARTON DE 11.34","11.34","1"],
["36","40","CARTON DE 4.1","4.1","1"],
["37","41","CARTON DE 17.4","17.4","1"],
["38","42","CARTON DE 13.4","13.4","1"],
["39","43","CARTON DE 12.3","12.3","1"],
["40","44","CARTON DE 9.2","9.2","1"],
["41","45","CARTON DE 5.65","5.65","1"],
["42","46","CARTON DE 10.5","10.5","1"],
["43","47","CARTON DE 10.2","10.2","1"],
["44","48","CARTON DE 9","9","1"],
["45","49","PLASTICO DE 12.3","12.3","1"],
["46","50","CARTON DE 5.7","5.7","1"],
["47","51","CARTON DE 3.750","3.75","1"],
["48","52","CARTON DE 11.15","11.15","1"],
["49","54","CARTON DE 11.14","11.14","1"],
["50","55","CARTON DE 391","391","1"],
["51","56","CARTON DE 16.8","16.8","1"],
["52","57","CARTON DE 4","4","0"],
["53","58","CARTON DE 14.5","14.5","1"],
["54","59","CARTON DE 13.5","13.5","1"],
["55","63","PLASTICO DE 18.10","18.1","1"],
["56","64","CARTON DE 9.8","9.8","1"],
["57","65","CARTON DE 11.10","11.1","1"],
["58","66","CARTON DE 16.2","16.2","1"],
["59","67","CARTON DE 22.6","22.6","1"],
["60","68","CARTON DE 370","370","1"],
["61","69","PLASTICO DE 18.14","18.14","1"],
["62","70","CARTON DE 3","3","1"],
["63","71","CARTON DE 390","390","1"],
["64","73","CARTON DE 16.4","16.4","1"],
["65","74","CARTON DE 11.5","11.5","1"],
["66","75","CARTON DE 5.3","5.3","1"],
["67","76","CARTON DE 10.9","10.9","1"],
["68","77","CARTON DE 11.7","11.7","1"],
["69","78","CARTON DE 11.4","11.4","1"],
["70","79","CARTON DE 16.6","16.6","1"],
["71","80","PLASTICO DE 16.6","16.6","1"],
["72","81","PLASTICO DE 6","6","1"],
["73","83","CARTON DE 14.55","14.55","1"],
["74","84","CARTON DE 7.00","7","1"],
["75","85","CARTON DE 14.3","14.3","1"],
["76","86","CARTON DE 2.6","2.6","1"],
["77","87","CARTON DE 5.4","5.4","1"],
["78","88","CARTON DE 2.5","2.5","1"],
["79","89","CARTON DE 8.5","8.5","1"],
["80","90","CARTON DE 8.6","8.6","1"],
["81","91","CARTON DE 17.3","17.3","1"],
["82","92","CARTON DE 13.3","13.3","1"],
["83","93","CARTON DE 16.3","16.3","1"],
["84","94","CARTON DE 16.95","16.95","1"],
["85","95","CARTON DE 11.6","11.6","1"],
["86","96","CARTON DE 8.3","8.3","1"],
["87","98","CARTON DE 8","8","1"],
["88","99","CARTON DE 15.8","15.8","1"],
["89","100","CARTON DE 15.5","15.5","1"],
["90","101","CARTON DE 7.5","7.5","1"],
["91","102","CARTON DE 5.55","5.55","1"],
["92","103","CARTON DE 9.6","9.6","1"],
["93","104","CARTON DE 22.5","22.5","1"],
["94","105","CARTON DE 9.7","9.7","1"],
["95","106","CARTON DE 4.8","4.8","1"],
["96","107","CARTON DE 5.63","5.63","1"],
["97","108","PLASTICO DE 13","13","1"],
["98","109","PLASTICO DE 8.5","8.5","1"],
["99","110","PLASTICO DE 8","8","1"],
["100","111","PLASTICO DE 7","7","1"],
["101","112","PLASTICO DE 8.6","8.6","1"],
["102","113","PLASTICO DE 20","20","1"],
["103","114","PLASTICO DE 16.75","16.75","1"],
["104","115","PLASTICO DE 15","15","1"],
["105","116","PLASTICO DE 9","9","1"],
["106","117","PLASTICO DE 8.475","8.475","1"],
["107","118","PLASTICO DE 10.5","10.5","1"],
["108","119","PLASTICO DE 8.3","8.3","1"],
["109","120","PLASTICO DE 14","14","1"],
["110","121","CARTON DE 10.6","10.6","1"],
["111","122","CARTON DE 8.4","8.4","1"],
["112","123","PLASTICO DE 28","28","1"],
["113","124","CARTON DE 380","380","1"],
["114","125","CARTON DE 15.62","15.62","1"],
["115","126","PLASTICO DE 10","10","0"],
["116","127","PLASTICO DE 13.5","13.5","1"],
["117","128","PLASTICO DE 420","420","1"],
["118","129","CARTON DE 15.60","15.6","1"],
["119","130","CARTON DE 15.750","15.75","1"],
["120","131","PLASTICO DE 14.5","14.5","1"],
["121","132","CARTON DE 16.1","16.1","1"],
["122","133","CARTON DE 9.68","9.68","1"],
["123","134","CARTON DE 9.27","9.27","1"],
["124","135","CARTON DE 13.1","13.1","1"],
["125","136","CARTON DE 4.5","4.5","1"],
["126","140","CARTON DE 8.8","8.8","1"],
["127","141","CARTON DE 55","55","0"],
["128","143","CARTON DE 1100","1100","1"],
["129","144","CARTON DE 8.48","8.48","1"],
["130","146","CARTON DE 12.6","12.6","1"],
["131","147","CARTON DE 3.7","3.7","1"],
["132","150","CARTON DE 23","23","1"],
["133","151","CARTON DE 320","320","1"],
["134","154","CARTON DE 5.626","5.626","1"],
["135","157","CARTON DE 4.56","4.56","1"],
["136","158","CARTON DE 16.7","16.7","1"],
["137","159","PLASTICO DE 13.1","13.1","1"],
["138","160","PLASTICO DE 8.4","8.4","1"],
["139","161","PLASTICO DE 18","18","1"],
["140","162","PLASTICO DE 11.3","11.3","1"],
["141","163","CARTON DE 8.625","8.625","1"],
["142","164","CARTON DE 10.85","10.85","1"],
["143","165","CARTON DE 5.75","5.75","1"],
["144","166","CARTON DE 8.1","8.1","1"],
["145","167","CARTON DE 395","395","1"],
["146","168","CARTON DE 6.5","6.5","1"],
["147","169","CARTON DE 9.72","9.72","1"],
["148","170","PLASTICO DE 19","19","1"],
["149","171","PLASTICO DE 21","21","1"],
["150","172","CARTON DE 6.65","6.65","1"]
]
